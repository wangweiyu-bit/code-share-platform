# ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è¯´æ˜

## æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·æµè§ˆå™¨                          â”‚
â”‚                   (Chrome/Firefox/Safari)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ HTTP è¯·æ±‚
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å‰ç«¯åº”ç”¨ (app.html)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  ç™»å½•é¡µ  â”‚  â”‚  ä»£ç é¡µ  â”‚  â”‚  ç®¡ç†é¡µ  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â†“              â†“              â†“                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚        JavaScript (app.js + auth.js)    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ API è°ƒç”¨
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åç«¯æœåŠ¡å™¨ (Express.js)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ auth.js  â”‚  â”‚ codes.js â”‚  â”‚ users.js â”‚              â”‚
â”‚  â”‚  è®¤è¯API â”‚  â”‚ ä»£ç API  â”‚  â”‚ ç”¨æˆ·API  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â†“              â†“              â†“                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚           æ•°æ®åº“å±‚ (db.js)              â”‚            â”‚
â”‚  â”‚         å†…å­˜å­˜å‚¨ / å¯å‡çº§ä¸ºçœŸå®æ•°æ®åº“    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°æ®æµå‘

### 1. ç”¨æˆ·ç™»å½•æµç¨‹

```
ç”¨æˆ·è¾“å…¥è´¦å·å¯†ç 
    â†“
å‰ç«¯å‘é€ POST /api/auth/login
    â†“
åç«¯éªŒè¯ç”¨æˆ·åå’Œå¯†ç 
    â†“
æŸ¥è¯¢æ•°æ®åº“ (db.findUserByUsername)
    â†“
éªŒè¯æˆåŠŸ â†’ è¿”å›ç”¨æˆ·ä¿¡æ¯
    â†“
å‰ç«¯ä¿å­˜åˆ° localStorage
    â†“
è·³è½¬åˆ°ä»£ç åˆ—è¡¨é¡µ
```

### 2. ä»£ç ä¸‹è½½æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»ä»£ç 
    â†“
å‰ç«¯æ£€æŸ¥ä¸‹è½½æƒé™ GET /api/codes/check-download
    â†“
åç«¯è®¡ç®—å·²ä¸‹è½½æ•°é‡
    â†“
æƒé™ä¸è¶³ â†’ æç¤ºå‡çº§ä¼šå‘˜
æƒé™å……è¶³ â†’ æ˜¾ç¤ºä»£ç è¯¦æƒ…
    â†“
ç”¨æˆ·ç‚¹å‡»ä¸‹è½½æŒ‰é’®
    â†“
å‰ç«¯å‘é€ POST /api/codes/download
    â†“
åç«¯è®°å½•ä¸‹è½½ (db.recordDownload)
    â†“
å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿
    â†“
æç¤ºä¸‹è½½æˆåŠŸ
```

### 3. ç®¡ç†å‘˜å®¡æ ¸æµç¨‹

```
ç”¨æˆ·æ³¨å†Œ
    â†“
åç«¯åˆ›å»ºç”¨æˆ· (status: pending)
    â†“
ç®¡ç†å‘˜ç™»å½•åå°
    â†“
æŸ¥çœ‹å¾…å®¡æ ¸ç”¨æˆ· GET /api/users/all?status=pending
    â†“
ç‚¹å‡»"é€šè¿‡"æˆ–"æ‹’ç»"
    â†“
å‰ç«¯å‘é€ POST /api/users/audit
    â†“
åç«¯æ›´æ–°ç”¨æˆ·çŠ¶æ€ (db.updateUser)
    â†“
ç”¨æˆ·å¯ä»¥ç™»å½•ä½¿ç”¨
```

---

## æŠ€æœ¯æ ˆè¯¦è§£

### å‰ç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç”¨é€” | æ–‡ä»¶ |
|------|------|------|
| HTML5 | é¡µé¢ç»“æ„ | app.html, index.html |
| CSS3 | æ ·å¼è®¾è®¡ | css/style.css |
| JavaScript | äº¤äº’é€»è¾‘ | js/app.js, js/auth.js |
| Fetch API | HTTP è¯·æ±‚ | js/auth.js |
| LocalStorage | æœ¬åœ°å­˜å‚¨ | js/auth.js |

### åç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç”¨é€” | æ–‡ä»¶ |
|------|------|------|
| Node.js | è¿è¡Œç¯å¢ƒ | - |
| Express.js | Web æ¡†æ¶ | api/server.js |
| CORS | è·¨åŸŸæ”¯æŒ | api/server.js |
| å†…å­˜æ•°æ®åº“ | æ•°æ®å­˜å‚¨ | api/db.js |

---

## API æ¥å£æ–‡æ¡£

### è®¤è¯æ¥å£ (auth.js)

#### POST /api/auth/login
ç™»å½•æ¥å£

**è¯·æ±‚ï¼š**
```json
{
  "username": "admin",
  "password": "admin123"
}
```

**å“åº”ï¼š**
```json
{
  "code": 0,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "id": 1,
    "username": "admin",
    "name": "ç®¡ç†å‘˜",
    "role": "admin",
    "level": "svip"
  }
}
```

#### POST /api/auth/register
æ³¨å†Œæ¥å£

**è¯·æ±‚ï¼š**
```json
{
  "username": "user1",
  "password": "123456",
  "name": "å¼ ä¸‰",
  "phone": "13800138000"
}
```

**å“åº”ï¼š**
```json
{
  "code": 0,
  "message": "æ³¨å†ŒæˆåŠŸï¼Œè¯·ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸",
  "data": { "id": 2 }
}
```

---

### ä»£ç æ¥å£ (codes.js)

#### GET /api/codes/list
è·å–ä»£ç åˆ—è¡¨

**å‚æ•°ï¼š**
- userId: ç”¨æˆ·ID
- userLevel: ç”¨æˆ·ç­‰çº§ (normal/vip/svip)

**å“åº”ï¼š**
```json
{
  "code": 0,
  "data": [
    {
      "id": 1,
      "title": "ç¤ºä¾‹ä»£ç ",
      "description": "è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹",
      "language": "JavaScript",
      "requiredLevel": "normal",
      "locked": false
    }
  ]
}
```

#### GET /api/codes/detail/:id
è·å–ä»£ç è¯¦æƒ…

**å“åº”ï¼š**
```json
{
  "code": 0,
  "data": {
    "id": 1,
    "title": "ç¤ºä¾‹ä»£ç ",
    "code": "console.log('Hello');",
    "language": "JavaScript"
  }
}
```

#### GET /api/codes/check-download
æ£€æŸ¥ä¸‹è½½æƒé™

**å‚æ•°ï¼š**
- userId: ç”¨æˆ·ID
- codeId: ä»£ç ID

**å“åº”ï¼š**
```json
{
  "code": 0,
  "data": {
    "downloadCount": 0,
    "maxDownloads": 1,
    "remainingDownloads": "1",
    "canDownload": true,
    "hasDownloaded": false
  }
}
```

#### POST /api/codes/download
è®°å½•ä¸‹è½½

**è¯·æ±‚ï¼š**
```json
{
  "userId": 1,
  "codeId": 1
}
```

**å“åº”ï¼š**
```json
{
  "code": 0,
  "message": "ä¸‹è½½æˆåŠŸ",
  "data": {
    "downloadCount": 1,
    "maxDownloads": 1,
    "remainingDownloads": "0"
  }
}
```

#### POST /api/codes/add
æ·»åŠ ä»£ç ï¼ˆç®¡ç†å‘˜ï¼‰

**è¯·æ±‚ï¼š**
```json
{
  "title": "æ–°ä»£ç ",
  "description": "æè¿°",
  "code": "ä»£ç å†…å®¹",
  "language": "JavaScript",
  "category": "ç¤ºä¾‹",
  "requiredLevel": "normal"
}
```

#### DELETE /api/codes/delete/:id
åˆ é™¤ä»£ç ï¼ˆç®¡ç†å‘˜ï¼‰

---

### ç”¨æˆ·æ¥å£ (users.js)

#### GET /api/users/all
è·å–æ‰€æœ‰ç”¨æˆ·

**å‚æ•°ï¼š**
- status: å¯é€‰ï¼Œç­›é€‰çŠ¶æ€ (pending/approved/rejected)

**å“åº”ï¼š**
```json
{
  "code": 0,
  "data": [
    {
      "id": 1,
      "username": "admin",
      "name": "ç®¡ç†å‘˜",
      "level": "svip",
      "status": "approved"
    }
  ]
}
```

#### POST /api/users/audit
å®¡æ ¸ç”¨æˆ·

**è¯·æ±‚ï¼š**
```json
{
  "userId": 2,
  "status": "approved"
}
```

#### POST /api/users/update-level
æ›´æ–°ç”¨æˆ·æƒé™

**è¯·æ±‚ï¼š**
```json
{
  "userId": 2,
  "level": "vip"
}
```

---

## æ•°æ®åº“ç»“æ„

### users è¡¨ï¼ˆç”¨æˆ·ï¼‰

```javascript
{
  id: 1,                    // ç”¨æˆ·ID
  username: 'admin',        // ç”¨æˆ·å
  password: 'admin123',     // å¯†ç 
  name: 'ç®¡ç†å‘˜',           // å§“å
  phone: 'admin',           // æ‰‹æœºå·
  role: 'admin',            // è§’è‰² (admin/user)
  level: 'svip',            // ç­‰çº§ (normal/vip/svip)
  status: 'approved',       // çŠ¶æ€ (pending/approved/rejected)
  createTime: '2026-01-07'  // åˆ›å»ºæ—¶é—´
}
```

### codes è¡¨ï¼ˆä»£ç ï¼‰

```javascript
{
  id: 1,                    // ä»£ç ID
  title: 'ç¤ºä¾‹ä»£ç ',        // æ ‡é¢˜
  description: 'æè¿°',      // æè¿°
  code: 'console.log()',    // ä»£ç å†…å®¹
  language: 'JavaScript',   // ç¼–ç¨‹è¯­è¨€
  category: 'ç¤ºä¾‹',         // åˆ†ç±»
  requiredLevel: 'normal',  // æ‰€éœ€æƒé™
  createTime: '2026-01-07'  // åˆ›å»ºæ—¶é—´
}
```

### downloads è¡¨ï¼ˆä¸‹è½½è®°å½•ï¼‰

```javascript
{
  userId: 1,                // ç”¨æˆ·ID
  codeId: 1,                // ä»£ç ID
  downloadTime: '2026-01-07' // ä¸‹è½½æ—¶é—´
}
```

---

## æƒé™æ§åˆ¶é€»è¾‘

### ç”¨æˆ·ç­‰çº§

```javascript
const levelOrder = {
  normal: 1,  // æ™®é€šç”¨æˆ·
  vip: 2,     // ä¼šå‘˜
  svip: 3     // è¶…çº§ä¼šå‘˜
};
```

### ä¸‹è½½é™åˆ¶

```javascript
const maxDownloads = {
  normal: 1,   // æ™®é€šç”¨æˆ·ï¼š1ä¸ªæ–‡ä»¶
  vip: 2,      // ä¼šå‘˜ï¼š2ä¸ªæ–‡ä»¶
  svip: -1     // è¶…çº§ä¼šå‘˜ï¼šæ— é™åˆ¶
};
```

### æƒé™åˆ¤æ–­

```javascript
// ä»£ç æ˜¯å¦é”å®š
const locked = userLevelValue < codeLevelValue;

// æ˜¯å¦å¯ä»¥ä¸‹è½½
const canDownload = 
  hasDownloaded ||                    // å·²ä¸‹è½½è¿‡
  maxDownloads === -1 ||              // æ— é™åˆ¶
  downloadCount < maxDownloads;       // æœªè¾¾ä¸Šé™
```

---

## éƒ¨ç½²æ¶æ„

### æœ¬åœ°éƒ¨ç½²

```
ç”¨æˆ·ç”µè„‘
  â†“
Node.js æœåŠ¡å™¨ (localhost:3000)
  â†“
å†…å­˜æ•°æ®åº“
```

### Vercel éƒ¨ç½²

```
ç”¨æˆ·æµè§ˆå™¨
  â†“
Vercel CDN (å…¨çƒåŠ é€Ÿ)
  â†“
Vercel Serverless Functions
  â†“
å†…å­˜æ•°æ®åº“ (æ¯æ¬¡éƒ¨ç½²é‡ç½®)
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼ˆæ¨èï¼‰

```
ç”¨æˆ·æµè§ˆå™¨
  â†“
Nginx (åå‘ä»£ç†)
  â†“
Node.js æœåŠ¡å™¨ (PM2 å®ˆæŠ¤è¿›ç¨‹)
  â†“
MySQL / MongoDB (çœŸå®æ•°æ®åº“)
```

---

## å®‰å…¨è€ƒè™‘

### å½“å‰å®ç°ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰

- âŒ å¯†ç æ˜æ–‡å­˜å‚¨
- âŒ æ—  JWT éªŒè¯
- âŒ æ—  HTTPS
- âŒ æ— è¯·æ±‚é™æµ
- âŒ æ—  SQL æ³¨å…¥é˜²æŠ¤

### ç”Ÿäº§ç¯å¢ƒå»ºè®®

- âœ… ä½¿ç”¨ bcrypt åŠ å¯†å¯†ç 
- âœ… ä½¿ç”¨ JWT è¿›è¡Œèº«ä»½éªŒè¯
- âœ… å¯ç”¨ HTTPS
- âœ… æ·»åŠ è¯·æ±‚é™æµï¼ˆé˜²æ­¢æš´åŠ›ç ´è§£ï¼‰
- âœ… ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆé˜²æ­¢ SQL æ³¨å…¥ï¼‰
- âœ… æ·»åŠ  CSRF ä¿æŠ¤
- âœ… æ·»åŠ  XSS è¿‡æ»¤

---

## æ€§èƒ½ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–

- âœ… å•é¡µåº”ç”¨ï¼ˆå‡å°‘é¡µé¢åˆ·æ–°ï¼‰
- âœ… æœ¬åœ°å­˜å‚¨ï¼ˆå‡å°‘é‡å¤è¯·æ±‚ï¼‰
- âš ï¸ å¯æ·»åŠ ï¼šä»£ç å‹ç¼©ã€å›¾ç‰‡ä¼˜åŒ–ã€æ‡’åŠ è½½

### åç«¯ä¼˜åŒ–

- âœ… å†…å­˜æ•°æ®åº“ï¼ˆå¿«é€Ÿè¯»å†™ï¼‰
- âš ï¸ å¯æ·»åŠ ï¼šRedis ç¼“å­˜ã€æ•°æ®åº“ç´¢å¼•ã€è¿æ¥æ± 

### ç½‘ç»œä¼˜åŒ–

- âœ… CORS æ”¯æŒ
- âš ï¸ å¯æ·»åŠ ï¼šGzip å‹ç¼©ã€CDN åŠ é€Ÿã€HTTP/2

---

## æ‰©å±•æ–¹å‘

### åŠŸèƒ½æ‰©å±•

1. **æ–‡ä»¶ä¸Šä¼ **
   - æ”¯æŒæ‹–æ‹½ä¸Šä¼ 
   - æ”¯æŒæ‰¹é‡ä¸Šä¼ 
   - æ”¯æŒå¤§æ–‡ä»¶ï¼ˆåˆ†ç‰‡ä¸Šä¼ ï¼‰

2. **æœç´¢åŠŸèƒ½**
   - å…³é”®å­—æœç´¢
   - æ ‡ç­¾ç­›é€‰
   - é«˜çº§æœç´¢

3. **ç¤¾äº¤åŠŸèƒ½**
   - ç”¨æˆ·è¯„è®º
   - ä»£ç è¯„åˆ†
   - æ”¶è—åŠŸèƒ½

4. **ç»Ÿè®¡åŠŸèƒ½**
   - ä¸‹è½½ç»Ÿè®¡
   - ç”¨æˆ·æ´»è·ƒåº¦
   - çƒ­é—¨ä»£ç æ’è¡Œ

### æŠ€æœ¯å‡çº§

1. **å‰ç«¯æ¡†æ¶**
   - Vue.js / React
   - TypeScript
   - UI ç»„ä»¶åº“

2. **åç«¯å‡çº§**
   - çœŸå®æ•°æ®åº“
   - Redis ç¼“å­˜
   - å¾®æœåŠ¡æ¶æ„

3. **éƒ¨ç½²å‡çº§**
   - Docker å®¹å™¨åŒ–
   - Kubernetes ç¼–æ’
   - CI/CD è‡ªåŠ¨åŒ–

---

## æ€»ç»“

### ä¼˜ç‚¹

- âœ… æ¶æ„æ¸…æ™°ï¼Œæ˜“äºç†è§£
- âœ… ä»£ç ç®€æ´ï¼Œæ˜“äºç»´æŠ¤
- âœ… åŠŸèƒ½å®Œæ•´ï¼Œå¼€ç®±å³ç”¨
- âœ… éƒ¨ç½²ç®€å•ï¼Œæˆæœ¬ä½å»‰

### é€‚ç”¨åœºæ™¯

- âœ… å°å‹å›¢é˜Ÿå†…éƒ¨ä½¿ç”¨
- âœ… æ•™è‚²åŸ¹è®­å¹³å°
- âœ… ä»£ç èµ„æºåº“
- âœ… å¿«é€ŸåŸå‹éªŒè¯

### ä¸é€‚ç”¨åœºæ™¯

- âŒ å¤§è§„æ¨¡å•†ä¸šåº”ç”¨ï¼ˆéœ€è¦å‡çº§æ¶æ„ï¼‰
- âŒ é«˜å¹¶å‘åœºæ™¯ï¼ˆéœ€è¦ä¼˜åŒ–æ€§èƒ½ï¼‰
- âŒ é«˜å®‰å…¨è¦æ±‚ï¼ˆéœ€è¦åŠ å¼ºå®‰å…¨ï¼‰

---

**å»ºè®®ï¼š** å…ˆç”¨äºæµ‹è¯•å’Œå°è§„æ¨¡ä½¿ç”¨ï¼Œæ ¹æ®å®é™…éœ€æ±‚é€æ­¥å‡çº§ï¼
